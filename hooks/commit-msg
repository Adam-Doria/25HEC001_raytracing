#!/bin/bash
# Git commit-msg hook pour v√©rifier le format Conventional Commits

commit_msg_file="$1"
commit_msg=$(cat "$commit_msg_file")

conventional_commit_regex='^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .{1,}'

echo "üîç V√©rification du format du message de commit..."

if ! [[ "$commit_msg" =~ $conventional_commit_regex ]]; then
    echo ""
    echo "‚ùå Erreur: Le message de commit ne respecte pas le format Conventional Commits"
    echo ""
    echo "üìã Format attendu:"
    echo "   type(scope): description"
    echo ""
    echo "üìù Types autoris√©s:"
    echo "   - feat:     Nouvelle fonctionnalit√©"
    echo "   - fix:      Correction de bug"
    echo "   - docs:     Documentation"
    echo "   - style:    Formatage, point-virgules manquants, etc."
    echo "   - refactor: Refactoring du code"
    echo "   - test:     Ajout ou modification de tests"
    echo "   - chore:    Maintenance, d√©pendances, etc."
    echo "   - perf:     Am√©lioration de performance"
    echo "   - ci:       Int√©gration continue"
    echo "   - build:    Syst√®me de build, d√©pendances externes"
    echo "   - revert:   Annulation d'un commit pr√©c√©dent"
    echo ""
    echo "‚úÖ Exemples valides:"
    echo "   feat: ajouter le calcul de raytracing"
    echo "   feat(camera): impl√©menter la classe Camera"
    echo "   fix: corriger le calcul de vecteur normalis√©"
    echo "   docs: mettre √† jour le README"
    echo "   refactor(core): simplifier la logique de Ray"
    echo ""
    echo "‚ùå Votre message:"
    echo "   $commit_msg"
    echo ""
    exit 1
fi


echo "‚úÖ Format du commit valide!"
exit 0
